import{c as W}from"./@babel.9e3f1cbd.js";import{r as G}from"./vue.b7e5b18a.js";var d=G,q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof W<"u"?W:typeof self<"u"?self:{};function M(y,u){return u={exports:{}},y(u,u.exports),u.exports}var _=M(function(y,u){(function(T,c){y.exports=c()})(q,function(){return function T(c,C,E){var i=window,g="application/octet-stream",f=E||g,o=c,p=!C&&!E&&o,s=document.createElement("a"),x=function(a){return String(a)},m=i.Blob||i.MozBlob||i.WebKitBlob||x,v=C||"download",h,B;if(m=m.call?m.bind(i):Blob,String(this)==="true"&&(o=[o,f],f=o[0],o=o[1]),p&&p.length<2048&&(v=p.split("/").pop().split("?")[0],s.href=p,s.href.indexOf(p)!==-1)){var k=new XMLHttpRequest;return k.open("GET",p,!0),k.responseType="blob",k.onload=function(a){T(a.target.response,v,g)},setTimeout(function(){k.send()},0),k}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(o))if(o.length>1024*1024*1.999&&m!==x)o=N(o),f=o.type||g;else return navigator.msSaveBlob?navigator.msSaveBlob(N(o),v):R(o);else if(/([\x80-\xff])/.test(o)){var b=0,A=new Uint8Array(o.length),L=A.length;for(b;b<L;++b)A[b]=o.charCodeAt(b);o=new m([A],{type:f})}h=o instanceof m?o:new m([o],{type:f});function N(a){var w=a.split(/[:;,]/),S=w[1],$=w[2]=="base64"?atob:decodeURIComponent,U=$(w.pop()),O=U.length,e=0,n=new Uint8Array(O);for(e;e<O;++e)n[e]=U.charCodeAt(e);return new m([n],{type:S})}function R(a,w){if("download"in s)return s.href=a,s.setAttribute("download",v),s.className="download-js-link",s.innerHTML="downloading...",s.style.display="none",document.body.appendChild(s),setTimeout(function(){s.click(),document.body.removeChild(s),w===!0&&setTimeout(function(){i.URL.revokeObjectURL(s.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(a)&&(a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g)),window.open(a)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=a),!0;var S=document.createElement("iframe");document.body.appendChild(S),!w&&/^data:/.test(a)&&(a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g)),S.src=a,setTimeout(function(){document.body.removeChild(S)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(h,v);if(i.URL)R(i.URL.createObjectURL(h),!0);else{if(typeof h=="string"||h.constructor===x)try{return R("data:"+f+";base64,"+i.btoa(h))}catch{return R("data:"+f+","+encodeURIComponent(h))}B=new FileReader,B.onload=function(a){R(this.result)},B.readAsDataURL(h)}return!0}})}),j={name:"vue3-json-excel",props:{type:{type:String,default:"xls"},jsonData:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:""},footer:{default:""},name:{type:String,default:"jsonData.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"\u88681"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},setup(y){const{type:u,fields:T,exportFields:c,beforeFinish:C,header:E,footer:i,stringifyLongNum:g,beforeGenerate:f,jsonData:o,fetch:p,defaultValue:s,name:x,worksheet:m}=d.toRefs(y),v=d.computed(()=>{var e=new Date().getTime();return"export_"+e}),h=d.computed(()=>{if(T)return d.toRaw(T.value);if(c)return c.value()}),B=async(e,n,t)=>{let r=k(e,t);typeof C=="function"&&await C(),_(r,n,t)},k=(e,n)=>{let t=window.btoa(window.unescape(encodeURIComponent(e))),r=atob(t),l=r.length,D=new Uint8ClampedArray(l);for(;l--;)D[l]=r.charCodeAt(l);return new Blob([D],{type:n})},b=e=>{let n='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',t="<thead>";const r=Object.keys(e[0]).length;E.value&&(t+=A(E.value,'<tr><th colspan="'+r+'">${data}</th></tr>')),t+="<tr>";for(let l in e[0])t+="<th>"+l+"</th>";return t+="</tr>",t+="</thead>",t+="<tbody>",e.map(function(l,D){t+="<tr>";for(let F in l)t+="<td>"+L(N(l[F]))+"</td>";t+="</tr>"}),t+="</tbody>",i.value&&(t+="<tfoot>",t+=A(i.value,'<tr><td colspan="'+r+'">${data}</td></tr>'),t+="</tfoot>"),n.replace("${table}",t).replace("${worksheet}",m.value)},A=(e,n)=>{let t="";if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]&&(t+=n.replace("${data}",e[r]));else t+=n.replace("${data}",e);return t},L=e=>{if(g.value){if(String(e).startsWith("0x"))return e;if(!isNaN(e)&&e!=""&&(e>99999999999||e<1e-13))return'="'+e+'"'}return e},N=e=>typeof e=="string"?e.replace(/\n/gi,"<br/>"):e,R=(e,n)=>{if(n)return n;let t={};for(let r in e[0])t[r]=r;return t},a=e=>e||e===0||typeof e=="boolean"?e:s.value,w=(e,n)=>{let t=e;for(let r of n)t&&(t=t[r]);return a(t)},S=(e,n)=>{if(typeof n!="function")return s.value;const t=n(e);return a(t)},$=(e,n)=>{const t=typeof e!="object"?e:e.field;let r=typeof t!="string"?[]:t.split("."),l=s.value;return t?r.length>1?l=w(n,r):l=a(n[t]):l=n,e.hasOwnProperty("callback")&&(l=S(l,e.callback)),l},U=(e,n)=>{let t=R(e,n).value,r=[];return e.map(function(l,D){let F={};for(let V in t){let I=t[V];F[V]=$(I,l)}r.push(F)}),r};return{idName:v,generate:async()=>{f&&typeof f.value=="function"&&await f.value();let e=o&&d.toRaw(o.value);if((p&&typeof p.value=="function"||!o)&&(e=await p.value()),e.length===0){console.warn("\u65E0\u5BFC\u51FA\u6570\u636E");return}const n=d.toRaw(e);let t=U(n,h);return u.value==="html"?B(b(t),x.value.replace(".xls",".html"),"text/html"):B(b(t),x.value,"application/vnd.ms-excel")},name:x}}};const J=["id"];function P(y,u,T,c,C,E){return d.openBlock(),d.createElementBlock("span",{id:c.idName,onClick:u[0]||(u[0]=(...i)=>c.generate&&c.generate(...i))},[d.renderSlot(y.$slots,"default",{},()=>[d.createTextVNode(" Download "+d.toDisplayString(c.name),1)])],8,J)}j.render=P;j.__file="src/components/json-excel.vue";var H="1.0.10-alpha";const K=H;console.log("version:"+K);const X=y=>{y.component(j.name,j)};var z={Vue3JsonExcel:j,install:X},Z=z;export{Z as v};
